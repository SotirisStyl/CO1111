<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Treasure Hunt Question</title>
    <link rel="stylesheet" href="quizdes.css">
</head>

<body>
<div id="points">Points: 0</div>
<button onclick="nextQuestion()" id="button">Skip  </button>

<main class="main">

    <div id="main">
        <h1 id="heading" >Treasure Hunt Question</h1>
        <div class=quiz></div>
    </div>


<div id="question"></div>


<!-- Update onclick events with correct field references -->
    <div id="forms">
<form id="textForm" style="display: none">
    <input type="text" id="textInput"/>
    <button type="button" onclick="answerQuestion(textField.value)">Submit Answer</button>
</form>

<form id="integerForm" style="display: none">
    <input type="number" id="integerInput"/>
    <button type="button" onclick="answerQuestion(integerField.value)">Submit Answer</button>
</form>

<form id="floatForm" style="display: none">
    <input type="number" step="0.01" id="floatInput"/>
    <button type="button" onclick="answerQuestion(floatField.value)">Submit Answer</button>
</form>


<form id="booleanForm" style="display: none">
    <input type="button" value="True" onclick="answerQuestion('True')"/>
    <input type="button" value="False" onclick="answerQuestion('False')"/>
</form>

<form id="mcqForm" style="display: none">
    <input type="button" value="A" onclick="answerQuestion('A')"/>
    <input type="button" value="B" onclick="answerQuestion('B')"/>
    <input type="button" value="C" onclick="answerQuestion('C')"/>
    <input type="button" value="D" onclick="answerQuestion('D')"/>
</form>
    </div>
</main>
<script>
    // Get session ID from storage
    const session = sessionStorage.getItem('session');

    //Text Form:
    const textForm = document.getElementById("textForm");
    const textField = document.getElementById("textInput");

    //Boolean form:
    const booleanForm = document.getElementById("booleanForm");

    //MCQ form:
    const mcqForm = document.getElementById("mcqForm");

    //Text Form:
    const integerForm = document.getElementById("integerForm");
    const integerField = document.getElementById("integerInput");

    //Text Form:
    const floatForm = document.getElementById("floatForm");
    const floatField = document.getElementById("floatInput");

    function getQuestion() {
        // Fetch question from API
        fetch("https://codecyprus.org/th/api/question?session= "+ session)
    .then(response => response.json())
            .then(jsonObject => {
                console.log(jsonObject);
                // Display question text
                const questionDiv = document.getElementById('question');
                questionDiv.innerHTML = `<p>${jsonObject.questionText}</p>`;

                // Create answer input based on question type
                showForm(jsonObject.questionType);
            })
            .catch(error => console.error(error));
    }

    function answerQuestion(answer) {
        // Submit answer to API
        fetch("https://codecyprus.org/th/api/answer?session= "+ session + "&answer= + answer")
    .then(response => response.json())
            .then(jsonObject => {
                console.log(jsonObject);
                // Display result message
                const resultDiv = document.getElementById('result');
                alert(jsonObject.message);

                //Adjust points
                adjustPoints(jsonObject.scoreAdjustment)

                if (!jsonObject.completed) {
                    getQuestion();
                } else {
                    location.href = "scoreboard.html";
                }
            })
            .catch(error => console.error(error));
    }

    function adjustPoints(score) {
        let points = 0;
        points += score;
        const pointsDiv = document.getElementById('points');
        pointsDiv.innerHTML = `Points: ${points}`;
    }

    function nextQuestion() {
        fetch("https://codecyprus.org/th/api/skip?session= "+ session)
    .then(response => response.json())
            .then(jsonObject => {
                console.log(jsonObject);
                getQuestion();
                adjustPoints(jsonObject.scoreAdjustment);
            })
            .catch(error => console.error(error));
    }

    getQuestion();

    // Helper function to get input type based on question type
    function showForm(questionType) {
        textForm.style.display = "none";
        floatForm.style.display = "none";
        integerForm.style.display = "none";
        booleanForm.style.display = "none";
        mcqForm.style.display = "none";
        switch (questionType) {
            case 'BOOLEAN':
                booleanForm.style.display = "block";
                textForm.style.display = "none";
                floatForm.style.display = "none";
                integerForm.style.display = "none";
                mcqForm.style.display = "none";
                break;
            case 'INTEGER':
                integerForm.style.display = "block";
                textForm.style.display = "none";
                floatForm.style.display = "none";
                booleanForm.style.display = "none";
                mcqForm.style.display = "none";
                break;
            case 'NUMERIC':
                floatForm.style.display = "block";
                textForm.style.display = "none";
                integerForm.style.display = "none";
                booleanForm.style.display = "none";
                mcqForm.style.display = "none";
                break;
            case 'MCQ':
                mcqForm.style.display = "block";
                textForm.style.display = "none";
                floatForm.style.display = "none";
                integerForm.style.display = "none";
                booleanForm.style.display = "none";
                break;
            case 'TEXT':
                textForm.style.display = "block";
                floatForm.style.display = "none";
                integerForm.style.display = "none";
                booleanForm.style.display = "none";
                mcqForm.style.display = "none";
                break;
        }
    }
</script>

<div id="result"></div>
</body>
</html>